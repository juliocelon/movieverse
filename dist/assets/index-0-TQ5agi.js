(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const g="63db0bb97ae40877eb2984aee64f3488",h="https://api.themoviedb.org/3",v="https://image.tmdb.org/t/p/w500",l=7,L="favoriteMovieIds",E="en-US";async function c(t,e={}){const o=new URLSearchParams({api_key:g,language:E,...e}).toString(),n=`${h}${t}?${o}`,r=await fetch(n);if(!r.ok)throw new Error(`HTTP error: ${r.status} from ${t}`);return r.json()}async function T(){try{return(await c("/movie/popular",{page:1})).results.slice(0,l)}catch(t){throw console.error("Error fetching popular movies:",t),t}}async function S(t){try{return(await c("/discover/movie",{with_genres:t,sort_by:"popularity.desc",page:1})).results.slice(0,l)}catch(e){throw console.error(`Error fetching movies by genre ${t}:`,e),e}}async function M(t){try{return await c(`/movie/${t}`)}catch(e){throw console.error(`Error fetching movie detail for ID ${t}:`,e),e}}async function C(t){if(!t||t.length<3)return[];try{return(await c("/search/movie",{query:encodeURIComponent(t),page:1})).results.slice(0,l)}catch(e){throw console.error("Error fetching movie search:",e),e}}function b(t){const e=t.id,o=t.poster_path,n=o?`${v}${o}`:"https://placehold.co/250x375/333333/ffffff?text=No+Poster";return`
        <a href="movie-detail.html?id=${e}" 
           class="movie-card" 
           style="background-image: url('${n}'); 
                  background-size: cover; 
                  background-position: center;">
        </a>
    `}function m(){const t=document.querySelector(".genre-results .movie-cards"),e=document.querySelector(".genre-results h2");!t||!e||(e.textContent="Genre Results",t.innerHTML="<p>Select a genre above to see movies here.</p>")}function u(t,e){const o=document.querySelector(t);if(o){if(o.innerHTML="",e.length===0){o.innerHTML="<p>No movies found.</p>";return}e.forEach(n=>{const r=b(n);o.insertAdjacentHTML("beforeend",r)})}}const f=".popular-movies .movie-cards",a=".genre-results .movie-cards",p=".genre-results h2";async function w(){const t=document.querySelector(f);if(t)try{const e=await T();u(f,e)}catch{t.innerHTML='<p style="color: red;">Error loading popular movies.</p>'}}async function A(){const t=document.querySelector(a),e=document.querySelector(p);if(!t||!e)return;const o=sessionStorage.getItem(L),n=o?JSON.parse(o):[];if(e.textContent="My Favorites",t.innerHTML="<p>Loading favorites...</p>",n.length===0){t.innerHTML="<p>You haven't added any movies to your favorites yet.</p>";return}try{const r=n.map(M),s=await Promise.all(r);u(a,s)}catch(r){console.error("Error loading favorite movies:",r),t.innerHTML='<p style="color: red;">Error loading your favorite movies.</p>',e.textContent="My Favorites"}}async function y(t,e){const o=document.querySelector(a),n=document.querySelector(p);if(!(!o||!n))try{o.innerHTML="<p>Loading movies...</p>",n.textContent=`${e} Hits`;const r=await S(t);u(a,r)}catch{o.innerHTML='<p style="color: red;">Error loading genre movies.</p>',n.textContent="Genre Results"}}function _(){const t=document.querySelectorAll(".genre-links a");t.forEach(e=>{e.addEventListener("click",o=>{o.preventDefault();const n=o.currentTarget.getAttribute("data-genre-id"),r=o.currentTarget.textContent,s=o.currentTarget.classList.contains("active");t.forEach(i=>i.classList.remove("active")),s?m():(o.currentTarget.classList.add("active"),n==="favorites"?A():y(n,r))})})}const d=".search-results",H=".search-bar";function R(t){const e=document.querySelector(d);if(!e)return;if(t.length===0){e.innerHTML='<div class="no-results">No movies found.</div>',e.style.display="block";return}let o=t.map(n=>{const r=n.release_date?new Date(n.release_date).getFullYear():"N/A";return`
            <a href="movie-detail.html?id=${n.id}" class="search-result-item">
                ${n.title} (${r})
            </a>
        `}).join("");e.innerHTML=o,e.style.display="block"}async function N(t){const e=document.querySelector(d);if(!t||t.length<3){e.innerHTML="",e.style.display="none";return}try{e.innerHTML='<div class="loading-results">Searching...</div>',e.style.display="block";const o=await C(t);R(o)}catch{e.innerHTML='<div class="error-results">Search error.</div>',e.style.display="block"}}function O(){const t=document.querySelector(H),e=document.querySelector(d);if(!t||!e)return;let o;t.addEventListener("input",n=>{clearTimeout(o);const r=n.target.value.trim();o=setTimeout(()=>{N(r)},300)}),document.addEventListener("click",n=>{const r=document.querySelector(".search-container");r&&!r.contains(n.target)&&(e.style.display="none")}),t.addEventListener("focus",()=>{e.innerHTML&&(e.style.display="block")})}document.addEventListener("DOMContentLoaded",()=>{w(),_(),O(),m();const t="28";y(t,"Action");const o=document.querySelector(`.genre-links a[data-genre-id="${t}"]`);o&&o.classList.add("active")});async function I(){console.log("EMPEZANDO");const t=await fetch("./get-api-key.js");if(console.log("AQUI"),!t.ok)throw new Error("Error al llamar a la funci√≥n segura");console.log("VOY");const e=await t.json();console.log("YA FUE"),console.log("Datos obtenidos de forma segura:",e)}I();
